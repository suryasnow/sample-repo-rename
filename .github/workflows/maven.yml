# This workflow will build a Java project with Maven, and cache/restore any dependencies to improve the workflow execution time
# For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-maven

name: Java CI with Maven

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK 11
      uses: actions/setup-java@v2
      with:
        java-version: '11'
        distribution: 'temurin'
        cache: maven
    
    - name: Build with Maven
      run: mvn -B package --file pom.xml
    
    sonarqube:
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@v2
          with:
            # Disabling shallow clone is recommended for improving relevancy of reporting
            fetch-depth: 0
        - name: SonarQube Scan
          uses: sonarsource/sonarqube-scan-action@master
          env:
            SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
            SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}    
    - name: Official SonarQube Scan
      # You may pin to the exact commit or the version.
      # uses: SonarSource/sonarqube-scan-action@7295e71c9583053f5bf40e9d4068a0c974603ec8
      uses: SonarSource/sonarqube-scan-action@v1.1.0
      env:
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
        SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}
      with:
        # Additional arguments to the sonar-scanner
        args: > # optional
          -Dsonar.verbose=true
        # Set the sonar.projectBaseDir analysis property
        # projectBaseDir: . # optional, default is .

    - name: ServiceNow DevOps Artifact Registration
      # You may pin to the exact commit or the version.
      # uses: rapdev-io/sn-devops-artifact@efb54c4cdf2ec4591b8c837f41843ac4e0a90801
      uses: rapdev-io/sn-devops-artifact@v2.0.1
      with:
        # DevOps Integration User Name
        devops-integration-user-name: devops.integration.user
        # DevOps Integration User Pass
        devops-integration-user-pass: DevOps1!
        # ServiceNow Instance Name (e.g.: rapdevio)
        instance-name: 
        # Orchestration tool id
        tool-id: 
        # Github context
        context-github: 
        # List of artifacts to register
        artifacts:       
    
    - name: ServiceNow DevOps Artifact Package
      # You may pin to the exact commit or the version.
      # uses: rapdev-io/sn-devops-package@5595518a072f040b0795e18f0e1fae091a05ed07
      uses: rapdev-io/sn-devops-package@v2.0.1
      with:
        # DevOps Integration User Name
        devops-integration-user-name: 
        # DevOps Integration User Pass
        devops-integration-user-pass: 
        # ServiceNow Instance Name (e.g.: rapdevio)
        instance-name: 
        # Orchestration tool id
        tool-id: 
        # Github context
        context-github: 
        # List of artifacts to register
        artifacts: 
        # Package name
        name: # optional
    
    - name: ServiceNow DevOps Change
      # You may pin to the exact commit or the version.
      # uses: rapdev-io/sn-devops-change@d81ab3123ec5da61f1f2d92d5b3661d9e0d66f35
      uses: rapdev-io/sn-devops-change@v2.0.1
      with:
        # DevOps Integration User Name
        devops-integration-user-name: 
        # DevOps Integration User Pass
        devops-integration-user-pass: 
        # ServiceNow Instance Name (e.g.: rapdevio)
        instance-name: 
        # Orchestration tool id
        tool-id: 
        # Github context
        context-github: 
        # Callback repo
        callback-repo: 
        # Callback pipeline ID
        callback-pipeline-id: 
        # Callback params
        callback-params: 
